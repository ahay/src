\input{pcsmacros}
\pgfdeclareimage[height=1.0in]{logo}{Fig/Madagascar}

\title[]{\mg \\ command line usage}
\author[]{Paul Sava}
\institute{
  Center for Wave Phenomena \\
  Colorado School of Mines \\
  psava@mines.edu
}
\date{}
\logo{}
\large

% ------------------------------------------------------------
\mode<beamer> { \cwpcover }

% ------------------------------------------------------------
\begin{frame} \frametitle{\mg mission}

  \begin{itemize}
  \item \textbf{a research environment} \\
    \uncover<2->{\alert{--open-source software package--}}
    \vfill
  \item \textbf{a technology transfer tool} \\
    \uncover<3->{\alert{--reproducible numeric experiments system--}}
    \vfill
  \end{itemize}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{why open source software?}

  \begin{columns}[t]
    \column{.5\textwidth} \cen{freedom}
    \cit{to use}
    \cit{to study}
    \cit{to modify}
    \cit{to redistribute}
    \cit{to improve}
    
    \column{.5\textwidth} \cen{reproducibility} 
  \end{columns}

\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{why numeric reproducibility?}

  \vfill
  \cen{collaborative research} 
  \vfill
  \cen{technology transfer}
  \vfill
  \cen{education}
  \vfill
  \cen{peer review}
  \vfill
  
\end{frame}
\cwpnote{}


% ------------------------------------------------------------
\begin{frame} \frametitle{\mg system}

  \begin{columns}
    \column{.25\textwidth}
    \textbf{software}
    \textbf{documents} \\
    \textbf{blog} \\
    \textbf{merchandise} \\
    \dots  
    \column{.75\textwidth}
    \alert{ \texttt{http://www.ahay.org} }
  \end{columns}
  
  \sep
  
  \begin{itemize}
  \item standard GPL license
  \item distributed development (academia/industry)
  \item version control (\texttt{subversion})
  \item installation and flows (\texttt{scons})
  \end{itemize}
  
\end{frame}
\cwpnote{}


% ------------------------------------------------------------
\begin{frame} \frametitle{\mg developers}

  \begin{itemize}
  \item University of Texas (Austin)
  \item Colorado School of Mines
  \item King Abdullah University of Science and Technology
  \item University of Western Australia
  \item \dots
  \end{itemize}
  
\end{frame}
\cwpnote{}


% ------------------------------------------------------------
\begin{frame} \frametitle{\mg heritage}

  \textbf{software system}
  \begin{itemize}
  \item SEPlib (Stanford University)
  \item SU (Colorado School of Mines)
  \item DDS (Amoco/BP)
  \end{itemize}
  
  \vfill
  
  \textbf{reproducible documents}
  \begin{itemize}
  \item SEP document system
  \end{itemize}

\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{\mg architecture}

  \begin{columns}
    \column{.25\textwidth}
    documents \\
    \vspace{0.25in}
    flows \\
    \vspace{0.25in}
    programs
    
    \column{.75\textwidth}
    $3$ overlapping layers
    
  \end{columns}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{\mg architecture}

  \begin{columns}
    \column{.25\textwidth}
    documents \\
    \vspace{0.25in}
    flows \\
    \vspace{0.25in}
    \textbf{programs}
    
    \column{.75\textwidth}
    \begin{itemize}
    \item provide basic processing modules
    \item C, C++, F90, Python, Matlab \dots
    \item communicate by pipes
    \end{itemize}
    
  \end{columns}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{\mg architecture}

  \begin{columns}
    \column{.25\textwidth}
    documents \\
    \vspace{0.25in}
    \textbf{flows} \\
    \vspace{0.25in}
    programs
    
    \column{.75\textwidth}
    \begin{itemize}
    \item provide processing history
    \item Python (SCons)
    \item combine processing modules
    \end{itemize}
    
  \end{columns}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{\mg architecture}

  \begin{columns}
    \column{.25\textwidth}
    \textbf{documents} \\
    \vspace{0.25in}
    flows \\
    \vspace{0.25in}
    programs
    
    \column{.75\textwidth}
    \begin{itemize}
    \item provide reproducible documents
    \item \LaTeX\; and SCons
    \item assemble text and numeric results
    \end{itemize}
    
  \end{columns}
  
\end{frame}
\cwpnote{}


% ------------------------------------------------------------
\begin{frame} \frametitle{programs}

  \begin{itemize}
  \item independent processing modules
  \item combined using pipes
  \item ``sf'' prefix
  \item documented by examples (``books'')
  \item implement SMP parallelism
  \item program count: $1028$ on 4/1/2014
  \end{itemize}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{program list}
  
  \mex{ {\bf sfdoc} -k .}

  \tiny
  \begin{semiverbatim}
    sfofpwd: Objective function of dip estimation with PWD filters.
    sfinfill: Shot interpolation.
    sfslice: Extract a slice using picked surface (usually from a stack or a semblance).
    sfin: Display basic information about RSF files.
    sfdmo: Kirchhoff DMO with antialiasing by reparameterization.
    sfradstretch: Stretch of the time axis.
    sflpef: Find PEF on aliased traces.
    sfrefer: Subtract a reference from a grid.
    sflevint: Leveler inverse interpolation in 1-D.
    sfnoise: Add random noise to the data.
    ...
  \end{semiverbatim}

\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{self documentation}

  \begin{itemize}
  \item run program without arguments
  \item find program purpose
  \item find execution parameters
  \item find execution examples
  \end{itemize}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{example}

  \mex{ {\bf sfspike} }

\tiny
\begin{semiverbatim}
NAME
        sfspike
DESCRIPTION
        Generate simple data: spikes, boxes, planes, constants.
SYNOPSIS
        sfspike > spike.rsf mag= nsp=1 k#=[0,...] l#=[k1,k2,...] p#=[0,...] n#=
o#=(0,...) d#=(0.004,0.1,0.1,...) label#=(Time,Distance,Distance,...) unit#=[s,km,km,...] title=
PARAMETERS
        float   d#=(0.004,0.1,0.1,...)  sampling on #-th axis
        ints    k#=[0,...]      spike starting position  [nsp]
        ints    l#=[k1,k2,...]  spike ending position  [nsp]
        string  label#=(Time,Distance,Distance,...)     label on #-th axis
        floats  mag=    spike magnitudes  [nsp]
        int     n#=     dimension of #-th axis
        int     nsp=1   Number of spikes
        float   o#=(0,...)      origin on #-th axis
        floats  p#=[0,...]      spike inclination (in samples)  [nsp]
        string  title=  title for plots
        string  unit#=[s,km,km,...]     unit on #-th axis
USED IN
        bei/conj/causint
        bei/dpmv/matt
        bei/dpmv/yalei
        bei/dwnc/vofz
	...
\end{semiverbatim}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{program execution}
  \framesubtitle{single input, single output}

  \mex{ 
    $<$ i.rsf
    {\bf sfprog} 
    arguments
    $>$ o.rsf 
  }
  
  \vfill
  
  \begin{itemize}
  \item sfprog = \mg program
  \item arguments = program arguments
  \item input from \texttt{stdin} ($<$)
  \item output to \texttt{stdout} ($>$)
  \end{itemize}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{demo}

  \mex{ 
    {\bf sfspike}
    n1=100 o1=0 d1=0.01 n2=50 o2=1000 d2=10
    $>$ f1.rsf 
  }
  
  \vfill
  \begin{itemize}
  \item standard in: none
  \item standart out: \mex{f1.rsf}
  \end{itemize}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{file format}

  \textbf{header}:
  \begin{itemize}
  \item text file (description of data)
  \item description of regularly-sampled format
  \item small, can be archived
  \end{itemize}
  
  \textbf{binary}:
  \begin{itemize}
  \item binary file (actual data)
  \item regularly-sampled data (native binary or XDR binary)
  \item large, can be stored on a different file system
  \item path to binary set with environment variable \texttt{DATAPATH}
  \end{itemize}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\inputdir{XFig}
% ------------------------------------------------------------

% ------------------------------------------------------------
\begin{frame} \frametitle{file format}
  \plot{rsfdata}{width=\textwidth}{}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{example}

  \mex{ {\bf sfin} }

\tiny
\begin{semiverbatim}
NAME
        sfin
DESCRIPTION
        Display basic information about RSF files.
SYNOPSIS
        sfin info=true check=2. trail=true file1.rsf file2.rsf ...
COMMENTS
        n1,n2,... are data dimensions
        o1,o2,... are axis origins
        d1,d2,... are axis sampling intervals
        label1,label2,... are axis labels
        unit1,unit2,... are axis units

PARAMETERS
        float   check=2.        Portion of the data (in Mb) to check for zero values.
        bool    info=y [y/n]    If n, only display the name of the data file.
        bool    trail=y [y/n]   If n, skip trailing dimensions of  one
USED IN
        data/sigsbee/fs2B
        data/sigsbee/nfs2B
	...
SOURCE
        filt/main/in.c
\end{semiverbatim}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{demo}

  \mex{ {\bf sfin} f1.rsf}

\tiny
\begin{semiverbatim}
f1.rsf:
    in="/scratch/f1.rsf@"
    esize=4 type=float form=native
    n1=100         d1=0.01        o1=0          label1="Time" unit1="s"
    n2=50          d2=10          o2=1000       label2="Distance" unit2="km"
        5000 elements 20000 bytes
\end{semiverbatim}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}

  \textbf{dataset} described by:
  \begin{itemize}
  \item header: \texttt{f1.rsf}
  \item binary: \texttt{in="/scratch/f1.rsf@"}
  \end{itemize}
  
  \vfill
  
  \textbf{axis} described by:
  \begin{itemize}
  \item $n$: number of samples
  \item $o$: sampling origin
  \item $d$: sampling rate (delta)
  \item $label$: axis label
  \item $unit$: axis unit
  \end{itemize}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{demo}

  \mex{ $<$ f1.rsf {\bf sfattr} }

\tiny
\begin{semiverbatim}
*******************************************
rms = 1
mean value = 1
norm value = 70.7107
variance = 0
standard deviation = 0
maximum value = 1 at 1 1
minimum value = 1 at 1 1
number of nonzero samples = 5000
total number of samples = 5000
*******************************************
\end{semiverbatim}

\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{compatibility}

  \begin{itemize}
  \item SEPlib: identical format
    \\
    \mex{ {\bf In} f1.rsf}
  \item SU: use converters
    \\
    \mex{ {\bf sfsegyread}  tape=f1.su su=y tfile=tfile.rsf endian=0
      \\ $>$ f1.rsf }
    \vspace{0.25in}
    \\
    \mex{ {\bf sfsegywrite} tape=f1.su su=y tfile=tfile.rsf endian=0
      \\ $<$ f1.rsf }
  \end{itemize}

\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{demo}

  \mex{ $<$ f1.rsf {\bf sfwindow} n2=25 min2=1200 $>$ f2.rsf}

  \vfill

  \mex{ {\bf sfin} f1.rsf}
\tiny
\begin{semiverbatim}
f1.rsf:
    in="/scratch/f1.rsf@"
    esize=4 type=float form=native
    n1=100         d1=0.01        o1=0          label1="Time" unit1="s"
    n2=50          d2=10          o2=1000       label2="Distance" unit2="km"
        5000 elements 20000 bytes
\end{semiverbatim}
\large

  \vfill

  \mex{ {\bf sfin} f2.rsf}
\tiny
\begin{semiverbatim}
f2.rsf:
    in="/scratch/f2.rsf@"
    esize=4 type=float form=native
    n1=100         d1=0.01        o1=0          label1="Time" unit1="s"
    n2=25          d2=10          o2=1200       label2="Distance" unit2="km"
        2500 elements 10000 bytes
\end{semiverbatim}
\end{frame}
\cwpnote{}


% ------------------------------------------------------------
\begin{frame} \frametitle{program execution}
  \framesubtitle{multiple inputs, multiple outputs}
  
  \mex{ 
    $<$ i.rsf 
    {\bf sfprog} 
    arguments
    l1=f1.rsf 
    l2=f2.rsf 
    $>$ o.rsf }

  \begin{itemize}
  \item input from \texttt{stdin} ($<$)
  \item output to \texttt{stdout} ($>$)
  \item \texttt{f1.rsf} can be open for input and/or output
  \item \texttt{f2.rsf} can be open for input and/or output
  \end{itemize}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{example}

  \mex{ {\bf sfbandpass} }

\tiny
\begin{semiverbatim}
NAME
        sfbandpass
DESCRIPTION
        Bandpass filtering. 
SYNOPSIS
        sfbandpass < in.rsf > out.rsf flo= fhi= phase=n verb=n nplo=6 nphi=6
PARAMETERS
        float   fhi=    High frequency in band, default is Nyquist 
        float   flo=    Low frequency in band, default is 0 
        int     nphi=6  number of poles for high cutoff 
        int     nplo=6  number of poles for low cutoff 
        bool    phase=n [y/n]   y: minimum phase, n: zero phase 
        bool    verb=n [y/n]    verbosity flag
SOURCE
        system/generic/Mbandpass.c
\end{semiverbatim}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{pipes}

  \begin{itemize}
  \item \mg programs can be piped
  \item \texttt{stdout} from one program becomes \texttt{stdin} for the next
  \item no intrinsic limit for the number of pipes
  \end{itemize}
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{demo}
  
  \mex{ $<$ f1.rsf 
    {\bf sfwindow} n2=25 min2=1200 $|$
    {\bf sftransp} 
    $>$ f3.rsf
  }
  
  \vfill
  \mex{ {\bf sfin} f1.rsf}
\tiny
\begin{semiverbatim}
f1.rsf:
    in="/scratch/f1.rsf@"
    esize=4 type=float form=native
    n1=100         d1=0.01        o1=0          label1="Time" unit1="s"
    n2=50          d2=10          o2=1000       label2="Distance" unit2="km"
        5000 elements 20000 bytes
\end{semiverbatim}
\large

  \vfill
  \mex{ {\bf sfin} f3.rsf}
\tiny
\begin{semiverbatim}
f3.rsf:
    in="/scratch/f3.rsf@"
    esize=4 type=float form=native
    n1=25          d1=10          o1=1200       label1="Distance" unit1="km"
    n2=100         d2=0.01        o2=0          label2="Time" unit2="s"
        2500 elements 10000 bytes
\end{semiverbatim}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}
  \big{useful utilities}
\end{frame}
\cwpnote{}


% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{example}

  \mex{ {\bf sfmath} }
  \tiny
\begin{semiverbatim}
NAME
        sfmath
DESCRIPTION
        Mathematical operations on data files.
SYNOPSIS
        sfmath > out.rsf type= unit= output=
COMMENTS

        Known functions: cos,  sin,  tan,  acos,  asin,  atan,
                         cosh, sinh, tanh, acosh, asinh, atanh,
                         exp,  log,  sqrt, abs, conj (for complex data).

        sfmath will work on float or complex data, but all the input and output
        files must be of the same data type.

        Examples:

        sfmath x=file1.rsf y=file2.rsf power=file3.rsf output='sin((x+2*y)^power)' > out.rsf
        sfmath < file1.rsf tau=file2.rsf output='exp(tau*input)' > out.rsf
        sfmath n1=100 type=complex output="exp(I*x1)"

        See also: sfheadermath.

PARAMETERS
        string  output=         Mathematical description of the output
        string  type=   output data type [float,complex]
        string  unit=
USED IN
        bei/dpmv/matt
        bei/dwnc/sigmoid
        bei/ft1/autocor
	...
\end{semiverbatim}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{demo}

  \mex{ 
    {\bf sfmath}
    n1=1000 output='sin(0.5*x1)'
    $>$ s1.rsf 
  }
  
  \vfill
  
  \mex{ {\bf sfin} s1.rsf}
\tiny
\begin{semiverbatim}
s1.rsf:
    in="/scratch/s1.rsf@"
    esize=4 type=float form=native
    n1=1000        d1=1           o1=0
        1000 elements 4000 bytes
\end{semiverbatim}
\large

\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{demo}

  \mex{ 
    {\bf sfmath}
    n1=300 n2=200 output='sin(0.25*x1+1*x2)'
    $>$ s2.rsf 
  }
  
  \vfill
  
  \mex{ {\bf sfin} s2.rsf}
\tiny
\begin{semiverbatim}
s2.rsf:
    in="/scratch/s2.rsf@"
    esize=4 type=float form=native
    n1=300         d1=1           o1=0
    n2=200         d2=1           o2=0
        60000 elements 240000 bytes
\end{semiverbatim}
\large

\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame} \frametitle{plotting}

\begin{itemize}
   \item {\bf sfgraph}: 1D graphs
   \item {\bf sfgrey}: 2D/3D grayscale graphs
   \item {\bf contour}: contour plots
   \item {\bf sfgrey3}: cube plots
   \item ...
\end{itemize}

\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{demo}

  \mex{ {\bf sfin} s1.rsf}

\tiny
\begin{semiverbatim}
s1.rsf:
    in="/scratch/s1.rsf@"
    esize=4 type=float form=native
    n1=1000        d1=1           o1=0
        1000 elements 4000 bytes
\end{semiverbatim}
\large

  \vfill
  
  \mex{ $<$ s1.rsf {\bf sfgraph} title='' $|$ {\bf xtpen}}

\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] \frametitle{demo}

  \mex{ {\bf sfin} s2.rsf}

\tiny
\begin{semiverbatim}
s2.rsf:
    in="/scratch/s2.rsf@"
    esize=4 type=float form=native
    n1=300         d1=1           o1=0
    n2=200         d2=1           o2=0
        60000 elements 240000 bytes
\end{semiverbatim}
\large

  \vfill

  \mex{ $<$ s2.rsf {\bf sfgrey} title='' $|$ {\bf xtpen}}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}
  \big{exercise}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\inputdir{gauss}
% ------------------------------------------------------------

% ------------------------------------------------------------
\begin{frame}[fragile] 
  \frametitle{create 2D Gaussian function}
  
  \mex{
    {\bf sfmath} output="exp(-(x1*x1+x2*x2)/(2*1.5*1.5))" \\
    n1=200 d1=0.1 o1=-10. n2=200 d2=0.1 o2=-10. $|$ \\
    {\bf sfput} label1=z unit1=km label2=x unit2=km $>$ gg.rsf
  }
  
  \vfill
  
  \mex{
    $<$ gg.rsf {\bf sfgrey} pclip=100 screenratio=1 title='' $|$
    {\bf xtpen}
  }
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}
  \plot{gg}{width=0.69\textwidth}{}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile]
  \frametitle{extract 1D subset}
  
  \mex{
    $<$ gg.rsf {\bf sfwindow} n2=1 f2=100 $>$ gg0.rsf
 }
  
  \vfill

  \mex{
    $<$ gg0.rsf {\bf sfgraph} title='' $|$
    {\bf xtpen}
  }
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}
  \plot{gg0}{width=0.90\textwidth}{}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] 
  \frametitle{create a velocity model}
  
  \mex{
    $<$ gg.rsf {\bf sfscale} rscale=-1. $|$ 
    {\bf sfadd} add=3 $>$ vel.rsf
  }
  
  \vfill
  
  \mex{
    $<$ vel.rsf {\bf sfgrey} title='' pclip=100 screenratio=1 $|$ 
    {\bf xtpen}
  }
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}
  \plot{vel}{width=0.69\textwidth}{}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile] 
  \frametitle{compute traveltimes}
  
  \mex{
    $<$ vel.rsf {\bf sfeikonal} zshot=-10 yshot=0 $>$ fme.rsf
  }
  
  \vfill
  
  \mex{
    $<$ fme.rsf {\bf sfcontour} title='' nc=200 screenratio=1 $|$
    {\bf xtpen}
  }
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}
  \plot{fme}{width=0.69\textwidth}{}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}[fragile]
  \frametitle{compute rays and wavefronts}
  
  \mex{
    $<$ vel.rsf {\bf sfhwt2d} xsou=0 zsou=-10 \\
    nt=1000 ot=0 dt=0.01 ng=1801 og=-90 dg=0.1 $>$ hwt.rsf
  }
  
  \vfill
  
  \mex{
    $<$ hwt.rsf {\bf sfwindow} j1=20 j2=20 $|$ \\
    {\bf sfgraph} title='' yreverse=y screenratio=1 \\
    min1=-10 max1=+10 min2=-10 max2=+10  $|$
    {\bf xtpen}
  }
  
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}
  \plot{hwt}{width=0.69\textwidth}{}
\end{frame}
\cwpnote{}

% ------------------------------------------------------------
\begin{frame}

  \big{\url{http://www.ahay.org}}
  
  \vfill

  \big{\texttt{\$RSF/book/rsf/school}}

  \vfill
  
  \begin{center}
    \pgfuseimage{logo}
  \end{center}
  
\end{frame}
\cwpnote{}

